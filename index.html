<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Unity Web Player | DailyRaffles</title>
    <link rel="stylesheet" href="TemplateData/style.css">

    <link rel="manifest" href="/manifest.json"> 
    <link rel="apple-touch-icon" href="/img/TG180.png">

    <style>
        body {
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        /* Контейнер для баннера - ЭТОТ ID НУЖНО ПЕРЕДАТЬ МЕНЕДЖЕРУ */
        #banner-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        /* Сам баннер */
        #banner-ad {
            width: 320px;
            height: 50px;
            background-color: #4a76a8;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        
        /* Контейнер для тестовых кнопок */
        #test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        
        #test-controls button {
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
    <script>
        // === Telegram Init ===
        function initTelegramFeatures() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                const isMobile = /Mobile|Android|iPhone/i.test(navigator.userAgent);

                try {
                    if (isMobile) {
                        Telegram.WebApp.expand();
                        Telegram.WebApp.disableVerticalSwipes();
                        Telegram.WebApp.lockOrientation('portrait');
                        console.log("Telegram mobile features initialized");
                    } else {
                        console.log("Telegram PC features initialized");
                    }

                    Telegram.WebApp.ready();
                } catch (e) {
                    console.error("Error initializing Telegram:", e);
                }
            } else {
                console.error("Telegram SDK not found!");
            }
        }

        function initTelegramBanner() {
            if (typeof TelegramAdsController === 'undefined') {
                console.error('❌ TelegramAdsController is undefined');
                return;
            }
            
            try {
                window.TelegramAdsController = new TelegramAdsController();
                console.log('✅ Constructor called successfully');
                
                // Инициализация рекламного баннера
                window.TelegramAdsController.initialize({
                    pubId: "982789", // Ваш publisher ID
                    appId: "3351",   // Ваш app ID
                    containerId: "banner-container" // Указываем контейнер для баннера
                })
                .then(() => {
                    console.log('✅ Инициализация баннера успешна');
                })
                .catch(error => {
                    console.error('❌ Ошибка инициализации баннера', error);
                });
                
            } catch (error) {
                console.error('❌ Error in initTelegramBanner:', error);
            }
        }

    </script>
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js" onload="initTelegramFeatures()"></script>

    <!-- RichInfo SDK для баннерной рекламы -->
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js" onload="initTelegramBanner()"></script>
</head>
<body>
    <!-- Unity Container -->
    <div id="unity-container" style="position: absolute; width: 100%; height: 100%; left: 0%; top: 0%;">
        <canvas id="unity-canvas" style="position: absolute; width: 100%; height: 100%;" tabindex="-1"></canvas>
        <div id="additional-background"></div> 
        <div id="unity-logo"></div>
        <div id="unity-warning"></div>
    </div>

    <!-- Контейнер для баннера - ЭТОТ ID НУЖНО ПЕРЕДАТЬ МЕНЕДЖЕРУ -->
    <div id="banner-container">
        <div id="banner-ad">
            Тестовый баннер 320x50
        </div>
    </div>
    
    <!-- Тестовые кнопки управления -->
    <div id="test-controls">
        <button onclick="hideBanner()">Скрыть баннер</button>
        <button onclick="showBanner()">Показать баннер</button>
        <button onclick="toggleBanner()">Переключить видимость</button>
    </div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then((reg) => console.log('SW зарегистрирован', reg))
      .catch((err) => console.error('SW ошибка', err));
  });
}

// Функции для управления баннером
function hideBanner() {
    document.getElementById('banner-container').style.display = 'none';
    console.log('Баннер скрыт');
}

function showBanner() {
    document.getElementById('banner-container').style.display = 'flex';
    console.log('Баннер показан');
}

function toggleBanner() {
    const banner = document.getElementById('banner-container');
    if (banner.style.display === 'none') {
        showBanner();
    } else {
        hideBanner();
    }
}

// Экспортируем функции для использования из Unity
window.hideBanner = hideBanner;
window.showBanner = showBanner;
window.toggleBanner = toggleBanner;
</script> 

    <script>
        // Код Unity...
    </script>
</body>
</html>